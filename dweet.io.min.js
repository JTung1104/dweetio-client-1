!function(){function t(t){return"[object Array]"===Object.prototype.toString.call(t)}function e(t){return"function"==typeof t}var n=!0;try{n=require}catch(o){n=!1}var r,i,c,u="last-thing.dat",l="https://dweet.io:443",a=!0,f=5e3;if(n){if(r=require("socket.io-client"),i=require("request"),require("fs").existsSync(u))try{c=require("fs").readFileSync(u).toString()}catch(o){}}else i=function(t,e){var n=t.url+(t.url.indexOf("?")+1?"&":"?"),o=[],r="";for(r in t.json)o.push(r+"="+encodeURIComponent(t.json[r]));for(var i="callback",c=0;window.dweetCallback[i+c];)c++;i+=c,window.dweetCallback[i]=function(t){e(null,t,t)},o.push("callback=dweetCallback."+i),o.push("_="+Date.now()),n+=o.join("&"),dweet_script_loader(n,function(t){t.parentNode.removeChild(t),window.dweetCallback[i]=void 0,delete window.dweetCallback[i]})},window.dweetCallback={},function(){var t=/ded|co/,e="onload",n="onreadystatechange",o="readyState",r=function(r,i){var c=document.createElement("script");c[e]=c[n]=function(){(!this[o]||t.test(this[o]))&&(c[e]=c[n]=null,i&&i(c),c=null)},c.async=!0,c.src=r,document.body.appendChild(c)};window.dweet_script_loader=function(t,e){if("string"==typeof t)return void r(t,e);var n=t.shift();r(n,function(n){t.length?window.dweet_script_loader(t,e):e&&e(n)})}}();var s=function(){function o(t){return t.created&&(t.created=new Date(t.created)),t}function s(t){if(t instanceof Array)for(var e=0;e<t.length;e++){var n=t[e];o(n)}else o(t);return t}function d(t){var e;try{e="string"==typeof t||t instanceof String?JSON.parse(t):t}catch(n){}return e}function w(t){var e,n=d(t);return n?"failed"==n["this"]&&(e=new Error(n.because)):e=new Error("server returned an invalid response"),e}function h(t,e){return e?t+(t.indexOf("?")+1?"&":"?")+"key="+encodeURIComponent(e):t}function v(t,e,n){var o=d(n);t||(t=w(o)),o&&o["with"]?e&&e(t,s(o["with"])):e&&e("no response from server",void 0)}var m,p=this,S={},g=c;p.set_server=function(t,e){l=t,a=e,n&&(require("https").globalAgent.options.rejectUnauthorized=e?!0:!1)},p.dweet=function(t,e){g?p.dweet_for(g,t,e):i({url:l+"/dweet",jar:!0,method:"POST",followAllRedirects:!0,timeout:f,strictSSL:a,json:t},function(t,o,r){var i=d(r);i["with"]&&i["with"].thing!=g&&(g=i["with"].thing,n&&require("fs").writeFile(u,g)),v(t,e,i)})},p.dweet_for=function(t,n,o,r){e(o)&&(r=o,o=null),i({url:h(l+"/dweet/for/"+t,o),jar:!0,method:"POST",followAllRedirects:!0,timeout:f,strictSSL:a,json:n},function(t,e,n){v(t,r,n)})},p.get_latest_dweet_for=function(t,n,o){e(n)&&(o=n,n=null),i({url:h(l+"/get/latest/dweet/for/"+t,n),jar:!0,timeout:f,strictSSL:a},function(t,e,n){v(t,o,n)})},p.get_all_dweets_for=function(t,n,o){e(n)&&(o=n,n=null),i({url:h(l+"/get/dweets/for/"+t,n),jar:!0,timeout:f,strictSSL:a},function(t,e,n){v(t,o,n)})},p.listen_for=function(t,o,i){function c(){m=r.connect(l+"/stream"),m.on("connect",function(){for(var t in S)m.emit("subscribe",{thing:t,key:o})}),m.on("new_dweet",function(t){if(S[t.thing]){s(t);for(var e=S[t.thing],n=0;n<e.length;n++)e[n](t)}})}e(o)&&(i=o,o=null),S[t]||(S[t]=[]),-1==S[t].indexOf(i)&&S[t].push(i),m?m&&m.socket.connected&&m.emit("subscribe",{thing:t}):n?c():dweet_script_loader([l+"/socket.io/socket.io.js"],function(){c()})},p.stop_listening=function(){S={},m&&(m.disconnect(),m=void 0)},p.stop_listening_for=function(t){S[t]=void 0,delete S[t],m&&m.emit("unsubscribe",{thing:t})},p.lock=function(t,e,n,o){i({url:l+"/lock/"+t+"?lock="+e+"&key="+n,jar:!0,timeout:f,strictSSL:a},function(t,e,n){t||(t=w(n)),o&&o(t)})},p.unlock=function(t,e,n){i({url:h(l+"/unlock/"+t,e),jar:!0,timeout:f,strictSSL:a},function(t,e,o){t||(t=w(o)),n&&n(t)})},p.remove_lock=function(t,e,n){i({url:l+"/remove/lock/"+t+"?key="+e,jar:!0,timeout:f,strictSSL:a},function(t,e,o){t||(t=w(o)),n&&n(t)})},p.set_alert=function(e,n,o,r,c){t(n)&&(n=n.join()),i({url:h(l+"/alert/"+encodeURIComponent(n)+"/when/"+e+"/"+encodeURIComponent(o),r),jar:!0,timeout:f,strictSSL:a},function(t,e,n){t||(t=w(n)),c&&c(t)})},p.get_alert=function(t,e,n){i({url:h(l+"/get/alert/for/"+t,e),jar:!0,timeout:f,strictSSL:a},function(t,e,o){t||(t=w(o));var r=d(o);n&&n(t,r["with"])})},p.remove_alert=function(t,e,n){i({url:l+"/remove/alert/for/"+t+"?key="+e,jar:!0,timeout:f,strictSSL:a},function(t,e,o){t||(t=w(o)),n&&n(t)})}};n?module.exports=s:window.dweetio=new s}();
//# sourceMappingURL=dweet.io.min.map